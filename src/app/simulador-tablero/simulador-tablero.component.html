<div class="p-4">
  <p *ngIf="cargando">Cargando tablero...</p>

  <div *ngIf="!cargando && tableroGrid.length" class="contenedor-tablero-panel">
    <!-- LADO IZQUIERDO: CONTROLES + TABLERO -->
    <div class="tablero-container">
      <!-- PAD DIRECCIONAL -->
      <div class="contenedor-controles">
        <div class="controles">
          <button class="boton-arriba" (click)="moverRobot('arriba')" aria-label="Mover arriba">âžœ</button>
          <div>
            <button class="boton-izquierda" (click)="moverRobot('izquierda')" aria-label="Mover izquierda">âžœ</button>
            <button class="boton-play" (click)="play()" aria-label="Reproducir">â–¶ï¸Ž</button>
            <button class="boton-derecha" (click)="moverRobot('derecha')" aria-label="Mover derecha">âžœ</button>
          </div>
          <button class="boton-abajo" (click)="moverRobot('abajo')" aria-label="Mover abajo">âžœ</button>
        </div>
      </div>

      <!-- COLA DE MOVIMIENTOS -->
      <div class="cola-movimientos" *ngIf="movimientosAcomulados.length">
        <span class="cola-titulo">
          Secuencia de movimientos ({{ movimientosAcomulados.length }})
        </span>
        <div class="cola-chips">
          <span class="chip-mov" *ngFor="let mov of movimientosAcomulados">
            {{ getIconoMovimiento($any(mov)) }}
          </span>
        </div>
        <button type="button" class="cola-clear" (click)="limpiarMovimientos()">
          Limpiar
        </button>
      </div>

      <!-- ZOOM -->
      <div *ngIf="mostrarZoom" class="zoom-bar">
        <span>Zoom:</span>
        <button (click)="zoomIn()">+</button>
        <button (click)="zoomOut()">âˆ’</button>
        <button *ngIf="zoomLevel !== 1" (click)="zoomReset()">Reset</button>
      </div>

      <!-- TABLERO -->
      <div class="tablero-wrapper">
        <div class="tablero-zoom" [ngStyle]="{ transform: 'scale(' + zoomLevel + ')' }">
          <!-- main tag -->
          <table class="tablero-especial">
            <tr>
              <td (click)="seleccionarCelda(-1, 0)">
                <div class="celda">
                  <p id="masTablero">main</p>
                  <div *ngIf="robotPos.fila === -1 && robotPos.columna === 0"
                       class="contenedor-robot"
                       [ngClass]="{
                         'rotar-90': robotPos.direccion === 'derecha',
                         'rotar-90neg': robotPos.direccion === 'izquierda',
                         'rotar-180': robotPos.direccion === 'abajo'
                       }">
                    <strong style="color: red;">ðŸ¤–</strong>
                  </div>
                </div>
              </td>
            </tr>
          </table>

          <!-- grid del tablero -->
          <table class="tablero" [ngStyle]="getFondoTablero()">
            <tr *ngFor="let fila of tableroGrid; let i = index">
              <td *ngFor="let celda of fila; let j = index"
                  (click)="seleccionarCelda(i, j)"
                  [ngStyle]="getEstiloCelda(i, j)">
                <div class="celda" style="background: transparent;">
                  <p id="masTablero">+</p>
                  <div *ngIf="robotPos.fila === i && robotPos.columna === j"
                       class="contenedor-robot"
                       [ngClass]="{
                         'rotar-90': robotPos.direccion === 'derecha',
                         'rotar-90neg': robotPos.direccion === 'izquierda',
                         'rotar-180': robotPos.direccion === 'abajo'
                       }">
                    <strong style="color: red;">ðŸ¤–</strong>
                  </div>
                </div>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>

    <!-- PANEL LATERAL -->
    <aside class="panel-lateral">
      <h2 class="panel-titulo">Tablero: {{ tablero.nombre }}</h2>

      <!-- ESTADO SIN CELDA SELECCIONADA -->
      <div *ngIf="!selectedCell" class="panel-lateral-sin-celda">
        <h3>Panel de acciones</h3>
        <p>Selecciona una celda del tablero para ver sus acciones.</p>
      </div>

      <!-- ESTADO CON CELDA SELECCIONADA -->
      <div *ngIf="selectedCell" class="panel-con-celda">
        <div class="panel-header">
          <h3>Celda ({{ selectedCell.fila }}, {{ selectedCell.columna }})</h3>
          <button class="cerrar" (click)="cerrarPanel()">âœ•</button>
        </div>
        <hr class="panel-separador">

        <div class="preview">
          <p><strong>Acciones actuales:</strong></p>
          <ul>
            <!-- main -->
            <ng-container *ngIf="selectedCell.fila === -1">
              <li *ngFor="let accion of mainTagAccions"
                  [ngClass]="'accion-' + accion.constructor.name">
                {{ getDescripcionAccion(accion) }}
                <ng-container *ngIf="esAudio(accion)">
                  <button (click)="reproducirAudio(accion.archivo)">ðŸ”Š</button>
                </ng-container>
              </li>
            </ng-container>

            <!-- celdas normales -->
            <ng-container *ngIf="selectedCell.fila !== -1">
              <li *ngFor="let accion of tableroGrid[selectedCell.fila][selectedCell.columna].acciones"
                  [ngClass]="'accion-' + accion.constructor.name">
                {{ getDescripcionAccion(accion) }}
                <ng-container *ngIf="esAudio(accion)">
                  <button (click)="reproducirAudio(accion.archivo)">ðŸ”Š</button>
                </ng-container>
              </li>
            </ng-container>
          </ul>
        </div>
      </div>
    </aside>
  </div>

  <div *ngIf="!cargando && !tableroGrid.length">
    <p>No hay acciones cargadas para este tablero.</p>
  </div>
</div>
